{"version":3,"names":["_react","require","_lodash","_interopRequireDefault","_dateFns","_useForm2","_utils","_reactNative","_ProductContext","useProductRegister","initialProduct","arguments","length","undefined","navigation","product","_useContext","useContext","ProductsContext","verifyProductId","createProduct","editProduct","_useForm","useForm","id","name","description","logo","releaseDate","date_release","Date","toISOString","reviewDate","date_revision","addYears","form","setFormValue","onChange","_useState","useState","_useState2","_slicedToArray2","default","isLoading","setIsLoading","_useState3","_useState4","isProductIdValid","setIsProductIdValid","_useState5","_useState6","isReleaseDateValid","setIsReleaseDateValid","handleReleaseChange","value","parseISO","Object","assign","handleVerifyProductId","_ref","_asyncToGenerator2","productId","validateInputs","isValid","error","Alert","alert","text","onPress","_x","apply","handleCreateOrUpdateProduct","_ref2","navigate","pop","debouncedHandleValidateId","_","debounce","clearForm","useEffect","cancel","_default","exports"],"sources":["useProductRegister.ts"],"sourcesContent":["import { useState, useEffect, useContext } from 'react';\n\nimport _ from 'lodash';\nimport { parseISO, addYears } from 'date-fns';\nimport { StackNavigationProp } from '@react-navigation/stack';\n\nimport { useForm } from './useForm'; \nimport { validateInputs } from '../utils';\nimport { Alert } from 'react-native';\nimport { Product } from '../interfaces';\nimport { ProductsContext } from '../context/ProductContext';\nimport { ProductsStackParams } from '../navigator/StackNavigator';\n\n\nconst useProductRegister = (\n  initialProduct: Product | null = null, \n  navigation: StackNavigationProp<ProductsStackParams, \"ProductRegisterScreen\", undefined>\n  ) => {\n    \n  const product = initialProduct;\n  const { verifyProductId, createProduct, editProduct } = useContext(ProductsContext);\n\n  const { form, setFormValue, onChange } = useForm({\n    id: product ? product.id : '',\n    name: product ? product.name : '',\n    description: product ? product.description : '',\n    logo: product ? product.logo : '',\n    releaseDate: product ? product.date_release : new Date().toISOString(),\n    reviewDate: product ? product.date_revision : addYears(new Date(), 1).toISOString(),\n  });\n  const { name, description, logo } = form;\n  const [isLoading, setIsLoading] = useState(false);\n  const [isProductIdValid, setIsProductIdValid] = useState<boolean>(false);\n  const [isReleaseDateValid, setIsReleaseDateValid] = useState<boolean>(false);\n\n  const handleReleaseChange = (value: string) => {\n    const releaseDate = parseISO(value);\n    const reviewDate = addYears(releaseDate, 1);\n    setFormValue({ ...form, releaseDate: value, reviewDate: reviewDate.toISOString() });\n  };\n\n  const handleVerifyProductId = async (productId: string) => {\n    try {\n      if (product) return;\n      if (validateInputs('ID', productId)) return setIsProductIdValid(true);\n      const isValid = await verifyProductId(productId);\n      setIsProductIdValid(isValid);\n    } catch (error) {\n      Alert.alert('Error', 'Hubo un error al validar el ID', [\n        {\n          text: 'Ok',\n          onPress: () => {},\n        },\n      ]);\n      return true;\n    }\n  };\n\n  const handleCreateOrUpdateProduct = async () => {\n    try {\n     if(\n         isProductIdValid\n         || validateInputs('name', name)\n         || validateInputs('description', description)\n         || validateInputs('logo', logo)\n         || isReleaseDateValid\n     ) return;\n\n     setIsLoading(true);\n\n     if( product ) {\n         await editProduct({\n             ...form,\n             date_release: form.releaseDate,\n             date_revision: form.reviewDate\n         })\n         setIsLoading(false);\n         navigation.navigate('ProductsScreen', {});\n     } else {\n         await createProduct({\n             ...form,\n             date_release: form.releaseDate,\n             date_revision: form.reviewDate\n         })\n         setIsLoading(false);\n         navigation.pop();\n     }\n\n    } catch (error) {\n     setIsLoading(false);\n     Alert.alert('Error', 'Hubo un error al crear el producto', [{ \n         text: 'Ok',\n         onPress: () => {}\n     }]);\n    }\n }\n\n  const debouncedHandleValidateId = _.debounce(handleVerifyProductId, 500);\n\n  const clearForm = () => {\n    setFormValue({\n      id: product ? product.id : '',\n      name: '',\n      description: '',\n      logo: '',\n      releaseDate: '',\n      reviewDate: '',\n    });\n  };\n\n  useEffect(() => {\n    debouncedHandleValidateId(form.id);\n    return () => {\n      debouncedHandleValidateId.cancel();\n    };\n  }, [form.id]);\n\n  useEffect(() => {\n    if (form.releaseDate) setIsReleaseDateValid(validateInputs('releaseDate', form.releaseDate));\n  }, [form.releaseDate]);\n\n  return {\n    form,\n    isLoading,\n    isProductIdValid,\n    isReleaseDateValid,\n    handleReleaseChange,\n    clearForm,\n    onChange,\n    debouncedHandleValidateId,\n    handleCreateOrUpdateProduct,\n  };\n};\n\nexport default useProductRegister;"],"mappings":";;;;;;;AAAA,IAAAA,MAAA,GAAAC,OAAA;AAEA,IAAAC,OAAA,GAAAC,sBAAA,CAAAF,OAAA;AACA,IAAAG,QAAA,GAAAH,OAAA;AAGA,IAAAI,SAAA,GAAAJ,OAAA;AACA,IAAAK,MAAA,GAAAL,OAAA;AACA,IAAAM,YAAA,GAAAN,OAAA;AAEA,IAAAO,eAAA,GAAAP,OAAA;AAIA,IAAMQ,kBAAkB,GAAG,SAArBA,kBAAkBA,CAAA,EAGjB;EAAA,IAFLC,cAA8B,GAAAC,SAAA,CAAAC,MAAA,QAAAD,SAAA,QAAAE,SAAA,GAAAF,SAAA,MAAG,IAAI;EAAA,IACrCG,UAAwF,GAAAH,SAAA,CAAAC,MAAA,OAAAD,SAAA,MAAAE,SAAA;EAGxF,IAAME,OAAO,GAAGL,cAAc;EAC9B,IAAAM,WAAA,GAAwD,IAAAC,iBAAU,EAACC,+BAAe,CAAC;IAA3EC,eAAe,GAAAH,WAAA,CAAfG,eAAe;IAAEC,aAAa,GAAAJ,WAAA,CAAbI,aAAa;IAAEC,WAAW,GAAAL,WAAA,CAAXK,WAAW;EAEnD,IAAAC,QAAA,GAAyC,IAAAC,iBAAO,EAAC;MAC/CC,EAAE,EAAET,OAAO,GAAGA,OAAO,CAACS,EAAE,GAAG,EAAE;MAC7BC,IAAI,EAAEV,OAAO,GAAGA,OAAO,CAACU,IAAI,GAAG,EAAE;MACjCC,WAAW,EAAEX,OAAO,GAAGA,OAAO,CAACW,WAAW,GAAG,EAAE;MAC/CC,IAAI,EAAEZ,OAAO,GAAGA,OAAO,CAACY,IAAI,GAAG,EAAE;MACjCC,WAAW,EAAEb,OAAO,GAAGA,OAAO,CAACc,YAAY,GAAG,IAAIC,IAAI,CAAC,CAAC,CAACC,WAAW,CAAC,CAAC;MACtEC,UAAU,EAAEjB,OAAO,GAAGA,OAAO,CAACkB,aAAa,GAAG,IAAAC,iBAAQ,EAAC,IAAIJ,IAAI,CAAC,CAAC,EAAE,CAAC,CAAC,CAACC,WAAW,CAAC;IACpF,CAAC,CAAC;IAPMI,IAAI,GAAAb,QAAA,CAAJa,IAAI;IAAEC,YAAY,GAAAd,QAAA,CAAZc,YAAY;IAAEC,QAAQ,GAAAf,QAAA,CAARe,QAAQ;EAQpC,IAAQZ,IAAI,GAAwBU,IAAI,CAAhCV,IAAI;IAAEC,WAAW,GAAWS,IAAI,CAA1BT,WAAW;IAAEC,IAAI,GAAKQ,IAAI,CAAbR,IAAI;EAC/B,IAAAW,SAAA,GAAkC,IAAAC,eAAQ,EAAC,KAAK,CAAC;IAAAC,UAAA,OAAAC,eAAA,CAAAC,OAAA,EAAAJ,SAAA;IAA1CK,SAAS,GAAAH,UAAA;IAAEI,YAAY,GAAAJ,UAAA;EAC9B,IAAAK,UAAA,GAAgD,IAAAN,eAAQ,EAAU,KAAK,CAAC;IAAAO,UAAA,OAAAL,eAAA,CAAAC,OAAA,EAAAG,UAAA;IAAjEE,gBAAgB,GAAAD,UAAA;IAAEE,mBAAmB,GAAAF,UAAA;EAC5C,IAAAG,UAAA,GAAoD,IAAAV,eAAQ,EAAU,KAAK,CAAC;IAAAW,UAAA,OAAAT,eAAA,CAAAC,OAAA,EAAAO,UAAA;IAArEE,kBAAkB,GAAAD,UAAA;IAAEE,qBAAqB,GAAAF,UAAA;EAEhD,IAAMG,mBAAmB,GAAG,SAAtBA,mBAAmBA,CAAIC,KAAa,EAAK;IAC7C,IAAM1B,WAAW,GAAG,IAAA2B,iBAAQ,EAACD,KAAK,CAAC;IACnC,IAAMtB,UAAU,GAAG,IAAAE,iBAAQ,EAACN,WAAW,EAAE,CAAC,CAAC;IAC3CQ,YAAY,CAAAoB,MAAA,CAAAC,MAAA,KAAMtB,IAAI;MAAEP,WAAW,EAAE0B,KAAK;MAAEtB,UAAU,EAAEA,UAAU,CAACD,WAAW,CAAC;IAAC,EAAE,CAAC;EACrF,CAAC;EAED,IAAM2B,qBAAqB;IAAA,IAAAC,IAAA,OAAAC,kBAAA,CAAAlB,OAAA,EAAG,WAAOmB,SAAiB,EAAK;MACzD,IAAI;QACF,IAAI9C,OAAO,EAAE;QACb,IAAI,IAAA+C,qBAAc,EAAC,IAAI,EAAED,SAAS,CAAC,EAAE,OAAOb,mBAAmB,CAAC,IAAI,CAAC;QACrE,IAAMe,OAAO,SAAS5C,eAAe,CAAC0C,SAAS,CAAC;QAChDb,mBAAmB,CAACe,OAAO,CAAC;MAC9B,CAAC,CAAC,OAAOC,KAAK,EAAE;QACdC,kBAAK,CAACC,KAAK,CAAC,OAAO,EAAE,gCAAgC,EAAE,CACrD;UACEC,IAAI,EAAE,IAAI;UACVC,OAAO,EAAE,SAAAA,QAAA,EAAM,CAAC;QAClB,CAAC,CACF,CAAC;QACF,OAAO,IAAI;MACb;IACF,CAAC;IAAA,gBAfKV,qBAAqBA,CAAAW,EAAA;MAAA,OAAAV,IAAA,CAAAW,KAAA,OAAA3D,SAAA;IAAA;EAAA,GAe1B;EAED,IAAM4D,2BAA2B;IAAA,IAAAC,KAAA,OAAAZ,kBAAA,CAAAlB,OAAA,EAAG,aAAY;MAC9C,IAAI;QACH,IACIK,gBAAgB,IACb,IAAAe,qBAAc,EAAC,MAAM,EAAErC,IAAI,CAAC,IAC5B,IAAAqC,qBAAc,EAAC,aAAa,EAAEpC,WAAW,CAAC,IAC1C,IAAAoC,qBAAc,EAAC,MAAM,EAAEnC,IAAI,CAAC,IAC5BwB,kBAAkB,EACvB;QAEFP,YAAY,CAAC,IAAI,CAAC;QAElB,IAAI7B,OAAO,EAAG;UACV,MAAMM,WAAW,CAAAmC,MAAA,CAAAC,MAAA,KACVtB,IAAI;YACPN,YAAY,EAAEM,IAAI,CAACP,WAAW;YAC9BK,aAAa,EAAEE,IAAI,CAACH;UAAU,EACjC,CAAC;UACFY,YAAY,CAAC,KAAK,CAAC;UACnB9B,UAAU,CAAC2D,QAAQ,CAAC,gBAAgB,EAAE,CAAC,CAAC,CAAC;QAC7C,CAAC,MAAM;UACH,MAAMrD,aAAa,CAAAoC,MAAA,CAAAC,MAAA,KACZtB,IAAI;YACPN,YAAY,EAAEM,IAAI,CAACP,WAAW;YAC9BK,aAAa,EAAEE,IAAI,CAACH;UAAU,EACjC,CAAC;UACFY,YAAY,CAAC,KAAK,CAAC;UACnB9B,UAAU,CAAC4D,GAAG,CAAC,CAAC;QACpB;MAED,CAAC,CAAC,OAAOV,KAAK,EAAE;QACfpB,YAAY,CAAC,KAAK,CAAC;QACnBqB,kBAAK,CAACC,KAAK,CAAC,OAAO,EAAE,oCAAoC,EAAE,CAAC;UACxDC,IAAI,EAAE,IAAI;UACVC,OAAO,EAAE,SAAAA,QAAA,EAAM,CAAC;QACpB,CAAC,CAAC,CAAC;MACJ;IACH,CAAC;IAAA,gBArCMG,2BAA2BA,CAAA;MAAA,OAAAC,KAAA,CAAAF,KAAA,OAAA3D,SAAA;IAAA;EAAA,GAqCjC;EAEA,IAAMgE,yBAAyB,GAAGC,eAAC,CAACC,QAAQ,CAACnB,qBAAqB,EAAE,GAAG,CAAC;EAExE,IAAMoB,SAAS,GAAG,SAAZA,SAASA,CAAA,EAAS;IACtB1C,YAAY,CAAC;MACXZ,EAAE,EAAET,OAAO,GAAGA,OAAO,CAACS,EAAE,GAAG,EAAE;MAC7BC,IAAI,EAAE,EAAE;MACRC,WAAW,EAAE,EAAE;MACfC,IAAI,EAAE,EAAE;MACRC,WAAW,EAAE,EAAE;MACfI,UAAU,EAAE;IACd,CAAC,CAAC;EACJ,CAAC;EAED,IAAA+C,gBAAS,EAAC,YAAM;IACdJ,yBAAyB,CAACxC,IAAI,CAACX,EAAE,CAAC;IAClC,OAAO,YAAM;MACXmD,yBAAyB,CAACK,MAAM,CAAC,CAAC;IACpC,CAAC;EACH,CAAC,EAAE,CAAC7C,IAAI,CAACX,EAAE,CAAC,CAAC;EAEb,IAAAuD,gBAAS,EAAC,YAAM;IACd,IAAI5C,IAAI,CAACP,WAAW,EAAEwB,qBAAqB,CAAC,IAAAU,qBAAc,EAAC,aAAa,EAAE3B,IAAI,CAACP,WAAW,CAAC,CAAC;EAC9F,CAAC,EAAE,CAACO,IAAI,CAACP,WAAW,CAAC,CAAC;EAEtB,OAAO;IACLO,IAAI,EAAJA,IAAI;IACJQ,SAAS,EAATA,SAAS;IACTI,gBAAgB,EAAhBA,gBAAgB;IAChBI,kBAAkB,EAAlBA,kBAAkB;IAClBE,mBAAmB,EAAnBA,mBAAmB;IACnByB,SAAS,EAATA,SAAS;IACTzC,QAAQ,EAARA,QAAQ;IACRsC,yBAAyB,EAAzBA,yBAAyB;IACzBJ,2BAA2B,EAA3BA;EACF,CAAC;AACH,CAAC;AAAC,IAAAU,QAAA,GAAAC,OAAA,CAAAxC,OAAA,GAEajC,kBAAkB"}